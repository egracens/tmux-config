# ==============================================================================
#
#   ████████╗███╗   ███╗██╗   ██╗██╗  ██╗
#   ╚══██╔══╝████╗ ████║██║   ██║╚██╗██╔╝
#      ██║   ██╔████╔██║██║   ██║ ╚███╔╝
#      ██║   ██║╚██╔╝██║██║   ██║ ██╔██╗
#      ██║   ██║ ╚═╝ ██║╚██████╔╝██╔╝ ██╗
#      ╚═╝   ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝
#
#   Egrace tmux configuration
#   Optimized for WSL + Neovim workflow
#
# ==============================================================================


# ==============================================================================
# GENERAL SETTINGS
# ==============================================================================

# Prefix key
set -g prefix C-b
unbind C-b
bind C-b send-prefix

# Terminal settings
set -g default-terminal "tmux-256color"

# Timing
set -sg escape-time 0              # No delay for escape key (instant vim mode switch)
set -g display-time 1000           # Display messages for 1 second
set -g repeat-time 300             # Time for repeatable commands
set -g status-interval 1           # Refresh status bar every 1 second

# History
set -g history-limit 50000         # Scrollback buffer size

# Behavior
set -g focus-events on             # Required for vim/neovim autoread
set -g remain-on-exit on           # Keep pane open after program exits
setw -g aggressive-resize on       # Better for multi-monitor setups


# ==============================================================================
# DISPLAY SETTINGS
# ==============================================================================

# True color support for modern terminals
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",alacritty:Tc"
set -ga terminal-overrides ",*256col*:Tc"

# Undercurl and colored underlines support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Terminal title
set -g set-titles on
set -g set-titles-string "#I:#W"


# ==============================================================================
# MOUSE & INPUT
# ==============================================================================

# Full mouse support
set -g mouse on

# Vi-style keybindings in copy mode
setw -g mode-keys vi


# ==============================================================================
# WINDOWS & PANES
# ==============================================================================

# Numbering starts at 1 (easier keyboard access)
set -g base-index 1
setw -g pane-base-index 1

# Window management
set -g renumber-windows on         # Renumber when window is closed
setw -g allow-rename off           # Prevent programs from renaming windows
setw -g automatic-rename off       # Manual control over window names


# ==============================================================================
# CLIPBOARD & ACTIVITY
# ==============================================================================

# System clipboard integration
set -g set-clipboard on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off         # No intrusive messages


# ==============================================================================
# STATUS BAR
# ==============================================================================

set -g status on
set -g status-position bottom


# ==============================================================================
# KEYBINDINGS - Windows & Panes
# ==============================================================================

# Windows
bind c new-window -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Renaming
bind r command-prompt -I "#{window_name}" "rename-window '%%'"
bind R command-prompt -I "#{session_name}" "rename-session '%%'"

# Zoom
bind + resize-pane -Z

# Killing
bind x kill-pane
bind X confirm-before -p "Kill window #W? (y/n)" kill-window
bind q confirm-before -p "Kill tmux server? (y/n)" kill-server

# Copy mode
bind v copy-mode


# ==============================================================================
# KEYBINDINGS - Navigation (no prefix needed)
# ==============================================================================

# Pane navigation: Ctrl + hjkl
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Pane resizing: Ctrl + Shift + hjkl
bind -n C-S-h resize-pane -L 2
bind -n C-S-j resize-pane -D 2
bind -n C-S-k resize-pane -U 2
bind -n C-S-l resize-pane -R 2


# ==============================================================================
# KEYBINDINGS - Copy Mode (vi-style)
# ==============================================================================

bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel


# ==============================================================================
# PLUGINS
# ==============================================================================

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# System monitoring
set -g @plugin 'tmux-plugins/tmux-cpu'

# Session management
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '1'

# Theme
set -g @plugin 'catppuccin/tmux'


# ==============================================================================
# THEME - Catppuccin
# ==============================================================================

# Flavor and style
set -g @catppuccin_flavor 'macchiato'
set -g @catppuccin_window_status_style 'rounded'

# Load Catppuccin (must be before status bar configuration)
run '~/.config/tmux/plugins/tmux/catppuccin.tmux'

# Window format
set -g @catppuccin_window_number '#I'
set -g @catppuccin_window_current_number '#I'
set -g @catppuccin_window_text ' #W'
set -g @catppuccin_window_current_text ' #W'

# Load custom status modules
source -F "$HOME/.config/tmux/modules/country.conf"
source -F "$HOME/.config/tmux/modules/ip.conf"
source -F "$HOME/.config/tmux/modules/memory.conf"

# Status bar layout
set -g status-left-length 100
set -g status-right-length 100
set -g status-left ""
set -g status-right "#{E:@catppuccin_status_country}"
set -ag status-right "#{E:@catppuccin_status_ip}"
set -ag status-right "#{E:@catppuccin_status_application}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -ag status-right "#{E:@catppuccin_status_memory}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"


# ==============================================================================
# TPM INITIALIZATION
# Keep this line at the very bottom of tmux.conf
# ==============================================================================

run '~/.config/tmux/plugins/tpm/tpm'
